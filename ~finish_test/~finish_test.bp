gv_left_motor = ""
gv_right_motor = ""
gv_not_inversed_motor = ""
gv_grabber_motor = ""
gv_motors = ""
gv_water_motor = ""
gv_left_sensor = 0
gv_right_sensor = 0
gv_line_sensor = 0
gv_ultrasonic = 0
gv_right_forward = 0
gv_left_forward = 0
gv_a = 0
gv_p = 0
gv_d = 0
gv_lasterror = 0
gv_nowerror = 0
gv_dif = 0
gv_integral = 0
gv_derivative = 0
gv_up = 0
gv_p_u = 0
gv_d_u = 0
gv_deg = 0
gv_is_chem_on_right = ""
gv_is_chem_on_left = ""
gv_brown = ""
gv_red = ""
gv_yellow = ""
gv_green = ""
gv_blue = ""
gv_white = ""
gv_chem = ""
gv_brown_man = ""
gv_red_man = ""
gv_yellow_man = ""
gv_green_man = ""
gv_blue_man = ""
gv_white_man = ""
gv_cubes_count = 0
gv_water_state = 0
gv_object = ""
gv_b = 0
gv_w = 0
gv_left_motor = "A"
gv_right_motor = "B"
gv_not_inversed_motor = "B"
gv_grabber_motor = "C"
gv_motors = gv_left_motor + gv_right_motor
gv_water_motor = "D"
gv_left_sensor = 2
gv_right_sensor = 3
gv_line_sensor = 1
gv_ultrasonic = 4
gv_right_forward = 1
gv_left_forward = - 1
gv_a = 0
gv_p = 1
gv_d = 6
gv_lasterror = 0
gv_nowerror = 0
gv_dif = 0
gv_integral = 0
gv_derivative = 0
gv_up = 0
gv_p_u = 1
gv_d_u = 0
gv_deg = 0
gv_is_chem_on_right = "False"
gv_is_chem_on_left = "False"
gv_brown = "False"
gv_red = "False"
gv_yellow = "False"
gv_green = "False"
gv_blue = "False"
gv_white = "False"
gv_chem = "False"
gv_brown_man = "False"
gv_red_man = "False"
gv_yellow_man = "False"
gv_green_man = "False"
gv_blue_man = "False"
gv_white_man = "False"
gv_cubes_count = 2
gv_water_state = 0
gv_object = ""
gv_b = 0
gv_w = 0
Sensor.SetMode ( gv_line_sensor , 0 )
Sensor.SetMode ( gv_right_sensor , 1 )
Sensor.SetMode ( gv_left_sensor , 1 )
Sensor.SetMode ( gv_ultrasonic , 0 )
If EV3.BatteryVoltage < 8 Then
LCD.Clear ()
LCD.Text ( 1 , 0 , 0 , 1 , "Low battery" )
f_beep_0 ()
f_delay_0 ()
f_beep_0 ()
EndIf
f_main_0 ()
Sub f_line_0
gv_nowerror = 20 - Sensor.ReadPercent ( 1 )
gv_dif = gv_lasterror - gv_nowerror
gv_integral = ( gv_integral + gv_nowerror ) / 10
gv_derivative = gv_nowerror - gv_lasterror
gv_up = ( ( gv_nowerror * gv_p ) + ( gv_integral * gv_d ) )
Motor.StartPower ( "B" , 40 - gv_up )
Motor.StartPower ( "A" , - 40 - gv_up )
gv_lasterror = gv_nowerror
EndSub
Sub f_ultrasonic_slow_0
gv_nowerror = Sensor.ReadRawValue ( gv_ultrasonic , 0 ) - gv_a
gv_dif = gv_lasterror - gv_nowerror
gv_integral = ( gv_integral + gv_nowerror ) / 10
gv_derivative = gv_nowerror - gv_lasterror
gv_up = ( ( gv_nowerror * gv_p_u ) + ( gv_integral * gv_d_u ) )
Motor.StartPower ( gv_right_motor , ( 20 + gv_up ) * gv_right_forward )
Motor.StartPower ( gv_left_motor , ( 20 - gv_up ) * gv_left_forward )
gv_lasterror = gv_nowerror
EndSub
Sub f_ultrasonic_superfast_0
gv_nowerror = Sensor.ReadRawValue ( gv_ultrasonic , 0 ) - gv_a
gv_dif = gv_lasterror - gv_nowerror
gv_integral = ( gv_integral + gv_nowerror ) / 10
gv_derivative = gv_nowerror - gv_lasterror
gv_up = ( ( gv_nowerror * gv_p_u ) + ( gv_integral * gv_d_u ) )
Motor.StartPower ( gv_right_motor , ( 60 + gv_up ) * gv_right_forward )
Motor.StartPower ( gv_left_motor , ( 60 - gv_up ) * gv_left_forward )
gv_lasterror = gv_nowerror
EndSub
Sub f_stop_0
Motor.Stop ( gv_motors , "True" )
EndSub
Sub f_delay_0
Program.Delay ( 300 )
EndSub
Sub f_beep_0
Speaker.Tone ( 100 , 500 , 200 )
EndSub
Sub f_close_cubes_0
Motor.Move ( gv_water_motor , - 10 , 70 , "True" )
EndSub
Sub f_open_cubes_0
Motor.Move ( gv_water_motor , 10 , 70 , "True" )
EndSub
Sub f_go_forward_0
gv_r_c = Motor.GetCount ( gv_right_motor ) * gv_right_forward
gv_l_c = Motor.GetCount ( gv_left_motor ) * gv_left_forward
gv_diff = ( gv_r_c - gv_l_c ) * 1
gv_r_p = ( 20 - gv_diff ) * gv_right_forward
gv_l_p = ( 20 + gv_diff ) * gv_left_forward
Motor.StartPower ( gv_right_motor , gv_r_p )
Motor.StartPower ( gv_left_motor , gv_l_p )
EndSub
Sub f_go_backward_0
gv_r_c = Motor.GetCount ( gv_right_motor ) * gv_right_forward
gv_l_c = Motor.GetCount ( gv_left_motor ) * gv_left_forward
gv_diff = ( gv_r_c - gv_l_c ) * 1
gv_r_p = ( - 20 - gv_diff ) * gv_right_forward
gv_l_p = ( - 20 + gv_diff ) * gv_left_forward
Motor.StartPower ( gv_right_motor , gv_r_p )
Motor.StartPower ( gv_left_motor , gv_l_p )
EndSub
Sub f_move_forward_0
Motor.ResetCount ( gv_left_motor )
Motor.ResetCount ( gv_right_motor )
While Motor.GetCount ( gv_not_inversed_motor ) < gv_deg
f_go_forward_0 ()
EndWhile
f_stop_0 ()
EndSub
Sub f_move_backward_0
Motor.ResetCount ( gv_left_motor )
Motor.ResetCount ( gv_right_motor )
While Motor.GetCount ( gv_not_inversed_motor ) > ( - 1 * gv_deg )
f_go_backward_0 ()
EndWhile
f_stop_0 ()
EndSub
Sub f_main_0
Motor.MoveSync ( gv_motors , gv_left_forward * - 20 , gv_right_forward * - 20 , 220 , "True" )
Motor.Move ( gv_left_motor , gv_left_forward * 20 , 360 , "True" )
gv_a = 107
Time.Reset1 ()
While Time.Get1 () < 4500
f_ultrasonic_superfast_0 ()
EndWhile
f_stop_0 ()
EndSub
